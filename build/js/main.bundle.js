(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=document.querySelector(".big-picture"),r=t.querySelector(".social__comments"),l=t.querySelector(".social__comment-count"),o=t.querySelector(".comments-loader"),s=document.querySelector("body"),c=t.querySelector(".big-picture__cancel");let n=[],i=5;const a=()=>{t.classList.add("hidden"),s.classList.remove("modal-open"),document.removeEventListener("keydown",d)},d=t=>{e(t)&&(t.preventDefault(),a(),c.removeEventListener("click",a))},u=e=>{i=e.length<5?e.length:i,console.log(i),n=e.slice(0,i),l.textContent=` ${n.length} из ${e.length} комментариев`,e.length>5&&n.length<e.length?(o.classList.remove("hidden"),o.addEventListener("click",(()=>{i+=5,u(e)}),{once:!0})):(o.classList.add("hidden"),i=5);const t=document.createDocumentFragment();n.forEach((e=>{const l=r.querySelector(".social__comment").cloneNode(!0);l.querySelector("img").src=e.avatar,l.querySelector("img").alt=e.name,l.querySelector(".social__text").textContent=e.message,t.appendChild(l)})),r.textContent="",r.appendChild(t)},m=document.querySelector("#picture").content.querySelector(".picture");let v=document.querySelector(".pictures");const y=e=>{let r=document.createDocumentFragment();e.forEach((e=>{let l=m.cloneNode(!0);l.querySelector(".picture__img").src=e.url,l.querySelector(".picture__likes").textContent=e.likes,l.querySelector(".picture__comments").textContent=e.comments.length,l.addEventListener("click",(r=>{r.preventDefault(),(e=>{t.classList.remove("hidden"),t.querySelector("img:first-of-type").src=e.url,t.querySelector(".likes-count").textContent=e.likes,t.querySelector(".social__caption").textContent=e.description,u(e.comments),s.classList.add("modal-open"),c.addEventListener("click",a),document.addEventListener("keydown",d)})(e)})),r.appendChild(l)})),v.appendChild(r)},p=document.querySelector(".img-upload__preview > img"),_=document.querySelector(".img-upload__form"),g=_.querySelector(".effect-level__slider"),f=_.querySelector(".effect-level__value"),L=_.querySelector(".img-upload__effect-level");noUiSlider.create(g,{range:{min:0,max:100},start:100,step:1,connect:"lower"});const h={phobos:()=>(L.classList.remove("visually-hidden"),`blur(${3*parseInt(f.value,10)*.01}px)`),heat:()=>(L.classList.remove("visually-hidden"),`brightness(${3*parseInt(f.value,10)*.01})`),marvin:()=>(L.classList.remove("visually-hidden"),`invert(${Math.floor(f.value)}%)`),sepia:()=>(L.classList.remove("visually-hidden"),`sepia(${.01*parseInt(f.value,10)})`),chrome:()=>(L.classList.remove("visually-hidden"),`grayscale(${.01*parseInt(f.value,10)})`),none:()=>(L.classList.add("visually-hidden"),"none")},S=()=>{const t=document.querySelector("#error").content.querySelector(".error").cloneNode(!0);t.style.zIndex="2";const r=t.querySelector(".error__button"),l=()=>{t.remove()};r.addEventListener("click",l),document.addEventListener("keydown",(t=>{e(t)&&(t.preventDefault(),l())})),document.addEventListener("click",(e=>{t.querySelector(".error__title").contains(e.target)||l()})),document.body.append(t)},q={GET:"https://22.javascript.pages.academy/kekstagram/data",POST:"https://22.javascript.pages.academy/kekstagram"},E=(e,t,r,l)=>{fetch(q[r],{method:r,body:l}).then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t()}))},k=document.querySelector(".img-upload__form"),b=k.querySelector(".text__hashtags"),C=k.querySelector(".text__description"),w=k.querySelector(".img-upload__submit"),x=["gif","jpg","jpeg","png"],D=document.querySelector("#upload-file"),V=document.querySelector(".img-upload__overlay"),$=document.querySelector("body"),I=V.querySelector("#upload-cancel"),T=V.querySelector(".scale__control--smaller"),j=V.querySelector(".scale__control--bigger"),A=V.querySelector(".scale__control--value"),U=V.querySelector(".img-upload__preview > img"),F=document.querySelectorAll(".effects__preview"),N=()=>{V.classList.add("hidden"),$.classList.remove("modal-open"),D.value="",document.removeEventListener("keydown",P)},P=t=>{e(t)&&(t.preventDefault(),N(),I.removeEventListener("click",N))},M=document.querySelector(".img-filters"),O=M.querySelector("#filter-default"),z=M.querySelector("#filter-random"),G=M.querySelector("#filter-discussed"),R=document.querySelector(".pictures"),W=(e,t)=>t.comments.length-e.comments.length,B=(e,t=500)=>{let r;return()=>{clearTimeout(r),r=setTimeout((()=>{e()}),t)}};D.addEventListener("change",(()=>{(()=>{let e=100;A.value=e+"%",U.style.transform="scale("+e/100+")",T.addEventListener("click",(()=>{e<=25?e-=0:(e-=25,A.value=e+"%",U.style.transform="scale("+e/100+")")})),j.addEventListener("click",(()=>{e>=100?e+=0:(e+=25,A.value=e+"%",U.style.transform="scale("+e/100+")")}))})(),L.classList.add("visually-hidden"),p.style.filter="none",_.addEventListener("change",(e=>{p.classList.remove(...p.classList),g.noUiSlider.set(100),e.target.matches(".effects__radio")&&(p.classList.add("effects__preview--"+e.target.value),f.value="100",p.style.filter=h[e.target.value](),g.noUiSlider.on("change",(()=>{f.value=g.noUiSlider.get(),p.style.filter=h[e.target.value]()})))})),b.value="",b.style.outline="none",b.setCustomValidity(""),b.addEventListener("input",(()=>{b.setCustomValidity("");let e=b.value.toLowerCase().trim();if(!e)return void(b.style.outline="none");let t=e.split(/\s+/);0!==t.length&&(t.forEach(((e,t)=>{/^[a-zа-я ^0-9#]*$/i.test(e)||b.setCustomValidity("не может содержать пробелы, спецсимволы (@, $ и т. п.)"),t>4&&b.setCustomValidity("нельзя указать больше пяти хэш-тегов")})),t.some((e=>"#"!==e[0]))&&b.setCustomValidity("хэш-тег начинается с символа #"),t.some((e=>e.length>20))&&b.setCustomValidity("максимальная длина одного хэш-тега 20 символов, включая решётку"),t.some((e=>"#"===e))&&b.setCustomValidity("хеш-тег не может состоять только из одной решётки"),t.some(((e,t,r)=>r.indexOf(e,t+1)>=t))&&b.setCustomValidity("один и тот же хэш-тег не может быть использован дважды"),b.validity.valid?b.style.outline="none":b.style.outline="3px red solid",b.reportValidity())})),b.addEventListener("keydown",(e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),e.stopPropagation())})),w.addEventListener("click",(e=>{b.validity.valid||e.preventDefault()})),C.value="",C.addEventListener("keydown",(e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),e.stopPropagation())})),C.addEventListener("change",(()=>{C.value.length>10?C.setCustomValidity("длина комментария не может составлять больше 140 символов"):C.setCustomValidity("")})),V.classList.remove("hidden"),$.classList.add("modal-open"),I.addEventListener("click",N),document.addEventListener("keydown",P);const e=D.files[0],t=e.name.toLowerCase();if(x.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{U.src=t.result,F.forEach((e=>{e.style.backgroundImage=`url(${t.result})`}))})),t.readAsDataURL(e)}})),E((e=>{var t;console.log(e),y(e),document.querySelector(".img-filters").classList.remove("img-filters--inactive"),t=e,O.addEventListener("click",(()=>{O.classList.add("img-filters__button--active"),z.classList.remove("img-filters__button--active"),G.classList.remove("img-filters__button--active"),R.querySelectorAll(".picture").forEach((e=>{e.remove()})),B((()=>y(t)))()})),z.addEventListener("click",(()=>{O.classList.remove("img-filters__button--active"),z.classList.add("img-filters__button--active"),G.classList.remove("img-filters__button--active"),R.querySelectorAll(".picture").forEach((e=>{e.remove()}));let e=function(e){let t,r=e.length;for(;0!=r;)t=Math.floor(Math.random()*r),r--,[e[r],e[t]]=[e[t],e[r]];return e}(t.slice()).slice(0,10);B((()=>y(e)))()})),G.addEventListener("click",(()=>{O.classList.remove("img-filters__button--active"),z.classList.remove("img-filters__button--active"),G.classList.add("img-filters__button--active"),R.querySelectorAll(".picture").forEach((e=>{e.remove()}));let e=t.slice().sort(W);B((()=>y(e)))()}))}),S,"GET"),(t=>{const r=()=>{(()=>{const t=document.querySelector("#success").content.querySelector(".success").cloneNode(!0);console.log(t);const r=t.querySelector(".success__button"),l=()=>{t.remove()};r.addEventListener("click",l),document.addEventListener("keydown",(t=>{e(t)&&(t.preventDefault(),l())})),document.addEventListener("click",(e=>{t.querySelector(".success__title").contains(e.target)||l()})),document.body.appendChild(t)})(),t()};k.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);E(r,S,"POST",t)}))})(N)})();
//# sourceMappingURL=main.bundle.js.map